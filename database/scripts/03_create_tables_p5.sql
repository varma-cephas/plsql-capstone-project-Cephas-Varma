-- Connect as the project user: STIS_ADMIN_28179

-- 1. CROP_TYPES Table (Reference Data)
CREATE TABLE CROP_TYPES (
    CROP_ID         NUMBER(10)      GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 100 INCREMENT BY 1) PRIMARY KEY,
    CROP_NAME       VARCHAR2(50)    NOT NULL UNIQUE,
    GROWTH_DAYS     NUMBER(5)       NOT NULL, -- Average days to harvest
    YIELD_PER_UNIT  NUMBER(10,2)    NOT NULL, -- Expected kg per sqm
    CONSTRAINT chk_growth_days CHECK (GROWTH_DAYS > 0),
    CONSTRAINT chk_yield_unit CHECK (YIELD_PER_UNIT >= 0)
) TABLESPACE STIS_DATA_TS;

-- 2. FARM_SUPPLIES Table (Inventory)
CREATE TABLE FARM_SUPPLIES (
    SUPPLY_ID       NUMBER(10)      GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 200 INCREMENT BY 1) PRIMARY KEY,
    ITEM_NAME       VARCHAR2(100)   NOT NULL UNIQUE,
    CURRENT_STOCK   NUMBER(10,2)    NOT NULL, -- Quantity on hand
    UNIT_OF_MEASURE VARCHAR2(20)    NOT NULL,
    UNIT_COST       NUMBER(10,2)    NOT NULL,
    CONSTRAINT chk_current_stock CHECK (CURRENT_STOCK >= 0),
    CONSTRAINT chk_unit_cost CHECK (UNIT_COST >= 0)
) TABLESPACE STIS_DATA_TS;

-- 3. PLANTING_BATCHES Table (Transactional Data)
CREATE TABLE PLANTING_BATCHES (
    BATCH_ID            NUMBER(10)      GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1000 INCREMENT BY 1) PRIMARY KEY,
    CROP_ID             NUMBER(10)      NOT NULL,
    SUPPLY_ID           NUMBER(10)      NOT NULL,
    PLANTING_DATE       DATE            NOT NULL,
    AREA_PLANTED_SQM    NUMBER(10,2)    NOT NULL,
    SEEDS_CONSUMED      NUMBER(10,2)    NOT NULL,
    STATUS              VARCHAR2(20)    DEFAULT 'PLANTED' NOT NULL,
    EXPECTED_HARVEST_DATE DATE          NULL, -- Calculated by PL/SQL later

    -- Foreign Keys
    CONSTRAINT fk_batch_crop FOREIGN KEY (CROP_ID) REFERENCES CROP_TYPES(CROP_ID),
    CONSTRAINT fk_batch_supply FOREIGN KEY (SUPPLY_ID) REFERENCES FARM_SUPPLIES(SUPPLY_ID),

    -- Check Constraints
    CONSTRAINT chk_area_planted CHECK (AREA_PLANTED_SQM > 0),
    CONSTRAINT chk_seeds_consumed CHECK (SEEDS_CONSUMED > 0),
    CONSTRAINT chk_batch_status CHECK (STATUS IN ('PLANTED', 'GROWING', 'HARVESTING', 'COMPLETED'))

) TABLESPACE STIS_DATA_TS;

-- 4. Create Indexes for FK columns (Optimization)
-- Index on CROP_ID in PLANTING_BATCHES
CREATE INDEX idx_batch_crop_id ON PLANTING_BATCHES (CROP_ID) TABLESPACE STIS_INDEX_TS;
-- Index on SUPPLY_ID in PLANTING_BATCHES
CREATE INDEX idx_batch_supply_id ON PLANTING_BATCHES (SUPPLY_ID) TABLESPACE STIS_INDEX_TS;

-- Verify all objects were created
SELECT table_name, tablespace_name FROM user_tables;